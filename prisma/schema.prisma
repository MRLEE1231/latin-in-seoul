// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 수업 게시글 모델
model Post {
  id               Int         @id @default(autoincrement())
  title            String?     // 제목 (선택)
  content          String      // 본문 텍스트 (필수)
  region           String?     // 지역: 'GANGNAM', 'HONGDAE', 'ETC'
  danceType        String?     // 종류: 'SALSA', 'BACHATA', 'KIZOMBA', 'ZOUK', 'ETC'
  instructorName   String?     // 강사명
  classDays        String?     // 수업요일: 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN' (쉼표로 구분)
  startDate        DateTime?   // 개강일 (수업 기간 시작)
  endDate          DateTime?   // 종강일 (수업 기간 종료)
  keywords         String?     // 해시태그/키워드 (쉼표로 구분, 예: 초보,소셜,bachata)
  classDescription String?     // 수업설명
  viewCount        Int         @default(0) // 조회수 (상세 페이지 로드 시 1회 증가)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  images           PostImage[] // 이미지 목록
  homeAds          HomeAd[]   // 메인 광고에서 이 수업을 선택한 경우

  @@map("posts")
}

// 관리자/사용자 (로그인)
model User {
  id           Int      @id @default(autoincrement())
  username     String   @unique
  passwordHash String
  role         String   // 'ADMIN' | 'USER'
  createdAt    DateTime @default(now())
  @@map("users")
}

// 게시글 이미지 모델
model PostImage {
  id        Int      @id @default(autoincrement())
  postId    Int
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  imageUrl  String   // 이미지 URL 경로
  imageOrder Int     @default(0) // 이미지 순서
  createdAt DateTime @default(now())

  @@map("post_images")
  @@index([postId])
}

// 일별 방문자 수 (당일 1회 쿠키 기준)
model DailyVisit {
  id    Int      @id @default(autoincrement())
  date  DateTime @unique @db.Date // 날짜만 (KST 기준 일자)
  count Int      @default(0)

  @@map("daily_visits")
}

// 메인 페이지 추천 광고 (이미지 + 제목 + 설명 + 링크)
model HomeAd {
  id          Int      @id @default(autoincrement())
  kind        String   @default("ETC") // 'CLASS'(수업) | 'ETC'(기타)
  postId      Int?     // kind가 CLASS일 때 연결된 수업 게시글 ID
  post        Post?    @relation(fields: [postId], references: [id], onDelete: SetNull)
  image       String   // 이미지 URL (업로드 파일 /ads/xxx 또는 수업 첫 이미지)
  title       String
  description String   @db.Text
  href        String   // 링크 (/posts/123 또는 https://...)
  order       Int      @default(0) // 노출 순서 (작을수록 먼저)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("home_ads")
  @@index([postId])
}
